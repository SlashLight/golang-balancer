# Балансировщик нагрузки
## Описание проекта
Данный проект представляет собой балансировщик нагрузки с поддержкой алгоритмов Round-Robin, Least-Connections и Hash-Based балансировки.

Реализован на Go с использованием стандартной библиотеки и поддержкой middleware для логирования, ограничения запросов (rate limiting) и проверки здоровья бэкендов.
Есть возможность создавать пользователей с пользовательскими ограничениями частоты запросов. Хранение данных происходит в СУБД Redis.

## Установка
Клонируйте репозиторий и установите зависимости:
   ```bash
   git clone https://github.com/SlashLight/golang-balancer/
   cd golang-balancer
   go mod download
   ```

## Конфигурация
Создайте файл **config.yaml**. Пример конфига:
```
env: "local"                  # настройка окружения. Есть "local", "dev", "prod". Влияет на уровень логирования
balancer:
  port: 8080                  # порт, на котором запущен балансировщик 
  backends:                   # URL адреса бэкенд-серверов, нагрузку на которые нужно балансировать
    - "http://localhost:8081"
    - "http://localhost:8082"
    - "http://localhost:8083"
  algorithm: "round-robin"    # или "hash", "least-connections"
  retries: 3                  # сколько попыток переподключения к другим серверам будет делать балансировщик (по умолчанию 3)
healthChecker:
  interval: 5s                # раз в сколько секунд будет опрашиваться состояние бэкендов  (по умолчанию 10 секунд)             
  checkURL: "/health"         # путь, по которому будет опрашиваться состояние бэкенд серверов
redis:
  addr: "localhost:6379"      # адреса Redis для подключения к нему
  dialTimeout: 5s             # таймаут на подключение (по умолчанию 5 секунд)
  readTimeout: 3s             # таймаут на чтение (по умолчанию 3 секунды)
  writeTimeout: 3s            # таймаут на запись (по умолчанию 3 секунды)
  pool: 100                   # максимальное число одновременных подключений к Redis (по умолчанию 100)
rate-limit:
  defaultCapacity: 20         # максимальное число запросов в секунду для обычного пользователя (по умолчнию 20)
  defaultRate: 2              # скорость восстановления числа запросов пользователя в секунду (по умолчанию 2)
```
Путь к конфигу указывается через переменную окружения **CONFIG_PATH**.

## Документация API
[Swagger](https://editor.swagger.io/?url=https://raw.githubusercontent.com/SlashLight/golang-balancer/refs/heads/main/openapi.yaml)


### Основные методы API
#### Клиенты
| Метод | Путь       | Описание          |
|-------|------------|-------------------|
| GET   | /clients   | Получить клиента  |
| POST  | /clients   | Добавить клиента  |
| PUT   | /clients   | Обновить клиента  |
| DELETE| /clients   | Удалить клиента   |

### Примеры запросов

**Получение клиента**:
```http
GET /clients?client_id=192.168.0.1
```

**Добавление клиента**:
```http
POST /clients
Content-Type: application/json

{
  "client_ip": "192.168.0.1",
  "capacity": 30,
  "rate": 2
}
```
